@using Microsoft.AspNetCore.Components.Authorization
@using RenzoAgostini.Client.Components
@inherits LayoutComponentBase

<nav class="nav">
    <div class="nav-container">
        <!-- Brand Logo -->
        <a class="nav-brand" href="/">
            <Icon Name="brand" CssClass="nav-brand-icon" />
            <span>Galleria Agostini</span>
        </a>

        <!-- Desktop Navigation Links -->
        <div class="nav-links">            
            <AuthorizeView Roles="admin">
                <Authorized>
                    <a class="nav-link" href="/admin/paintings">
                        <Icon Name="gallery" />
                        <span>Gestisci Quadri</span>
                    </a>
                    <a class="nav-link" href="/admin/orders">
                        <Icon Name="orders" />
                        <span>Ordini</span>
                    </a>
                    <a class="nav-link" href="/admin/shipping">
                        <Icon Name="shipping" />
                        <span>Spedizioni</span>
                    </a>
                    <a class="nav-link" href="/admin/custom-orders">
                        <Icon Name="requests" />
                        <span>Richieste</span>
                    </a>
                </Authorized>
            </AuthorizeView>
            <a class="nav-link" href="/richiedi-quadro">
                <Icon Name="custom" />
                <span>Quadro Personalizzato</span>
            </a>
        </div>

        <!-- Spacer -->
        <div class="nav-spacer"></div>

        <!-- Cart Button -->
        <a class="nav-cart" href="/cart">
            <Icon Name="cart" />
            <span>Carrello</span>
            <span class="nav-cart-count @(cartCount > 0 ? "animate-bounce" : "")">@cartCount</span>
        </a>

        <!-- User Section -->
        <div class="nav-user">
            <AuthorizeView>
                <Authorized>
                    <div class="nav-user-info">
                        <span class="nav-welcome">Benvenuto</span>
                        <span class="nav-username">@context.User.Identity?.Name</span>
                    </div>
                    <button class="nav-logout-btn" @onclick="LogoutAsync">
                        <Icon Name="logout" />
                        <span>Esci</span>
                    </button>
                </Authorized>
                <NotAuthorized>
                    <button class="nav-login-btn" @onclick="ShowLoginModal">
                        <Icon Name="login" />
                        <span>Accedi</span>
                    </button>
                </NotAuthorized>
            </AuthorizeView>
        </div>

        <!-- Mobile Menu Toggle -->
        <button class="nav-mobile-toggle" @onclick="ToggleMobileMenu">
            <Icon Name="menu" />
        </button>
    </div>
</nav>

<!-- Mobile Navigation -->
<div class="nav-mobile @(showMobileMenu ? "active" : "")" @onclick="CloseMobileMenu">
    <div class="nav-mobile-content" @onclick:stopPropagation="true">
        <div class="nav-mobile-header">
            <a class="nav-brand" href="/" @onclick="CloseMobileMenu">
                <Icon Name="brand" CssClass="nav-brand-icon" />
                <span>Galleria</span>
            </a>
            <button class="nav-mobile-close" @onclick="CloseMobileMenu">
                <Icon Name="close" />
            </button>
        </div>

        <div class="nav-mobile-links">
            <a class="nav-mobile-link" href="/" @onclick="CloseMobileMenu">
                <Icon Name="home" />
                <span>Home</span>
            </a>
            <a class="nav-mobile-link" href="/richiedi-quadro" @onclick="CloseMobileMenu">
                <Icon Name="custom" />
                <span>Quadro Personalizzato</span>
            </a>
            <AuthorizeView Roles="admin">
                <Authorized>
                    <a class="nav-mobile-link" href="/admin/paintings" @onclick="CloseMobileMenu">
                        <Icon Name="gallery" />
                        <span>Gestisci Quadri</span>
                    </a>
                    <a class="nav-mobile-link" href="/admin/orders" @onclick="CloseMobileMenu">
                        <Icon Name="orders" />
                        <span>Ordini</span>
                    </a>
                    <a class="nav-mobile-link" href="/admin/shipping" @onclick="CloseMobileMenu">
                        <Icon Name="shipping" />
                        <span>Spedizioni</span>
                    </a>
                    <a class="nav-mobile-link" href="/admin/custom-orders" @onclick="CloseMobileMenu">
                        <Icon Name="requests" />
                        <span>Richieste Personalizzate</span>
                    </a>
                </Authorized>
            </AuthorizeView>
        </div>

        <div class="nav-mobile-actions">
            <a class="btn btn-outline btn-full" href="/cart" @onclick="CloseMobileMenu">
                <Icon Name="cart" />
                <span>Carrello (@cartCount)</span>
            </a>
            <AuthorizeView>
                <Authorized>
                    <div class="nav-user-info" style="text-align: center; margin-bottom: 1rem;">
                        <div class="nav-welcome">Benvenuto</div>
                        <div class="nav-username">@context.User.Identity?.Name</div>
                    </div>
                    <button class="btn btn-secondary btn-full" @onclick="LogoutAsync">
                        <Icon Name="logout" />
                        <span>Esci</span>
                    </button>
                </Authorized>
                <NotAuthorized>
                    <button class="btn btn-primary btn-full" @onclick="ShowLoginModal">
                        <Icon Name="login" />
                        <span>Accedi</span>
                    </button>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="main-container">
    <div class="main-content">
        @Body
    </div>
</div>

<!-- Toast Container (per notifiche future) -->
<div class="toast-container" id="toast-container"></div>