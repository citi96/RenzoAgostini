@using Microsoft.AspNetCore.Components.Authorization
@using RenzoAgostini.Client.Components
@using RenzoAgostini.Shared.Constants
@inherits LayoutComponentBase

<nav class="nav">
    <div class="nav-container">
        <!-- Left: Brand Logo -->
        <div class="nav-start">
            <a class="nav-brand" href="/" aria-label="Galleria Agostini">
                <img src="/assets/logo.png" alt="Logo Galleria Agostini" class="nav-brand-logo" />
            </a>
        </div>

        <!-- Center: Desktop Navigation Links -->
        <div class="nav-links">
            <AuthorizeView Roles="@RoleNames.Admin">
                <Authorized>
                    <div class="nav-dropdown-container">
                        <button class="nav-link dropdown-toggle" @onclick="ToggleAdminMenu">
                            <Icon Name="settings" />
                            <span>Amministrazione</span>
                            <Icon Name="chevron-down" Class="dropdown-arrow" />
                        </button>
                        <div class="nav-dropdown-menu @(isAdminMenuOpen ? "show" : "")">
                            <a class="dropdown-item" href="/admin/paintings" @onclick="CloseAdminMenu">
                                <Icon Name="gallery" />
                                <span>Gestisci Quadri</span>
                            </a>
                            <a class="dropdown-item" href="/admin/orders" @onclick="CloseAdminMenu">
                                <Icon Name="orders" />
                                <span>Ordini</span>
                            </a>
                            <a class="dropdown-item" href="/admin/shipping" @onclick="CloseAdminMenu">
                                <Icon Name="shipping" />
                                <span>Spedizioni</span>
                            </a>
                            <a class="dropdown-item" href="/admin/custom-orders" @onclick="CloseAdminMenu">
                                <Icon Name="requests" />
                                <span>Richieste</span>
                            </a>
                            <a class="dropdown-item" href="/admin/users" @onclick="CloseAdminMenu">
                                <Icon Name="user" />
                                <span>Utenti</span>
                            </a>
                        </div>
                    </div>
                </Authorized>
            </AuthorizeView>
            <a class="nav-link" href="/chi-sono">
                <Icon Name="user" />
                <span>Chi Sono</span>
            </a>
            <a class="nav-link" href="/richiedi-quadro">
                <Icon Name="custom" />
                <span>Quadro Personalizzato</span>
            </a>
        </div>

        <!-- Right: Actions -->
        <div class="nav-end">
            <!-- Cart Button -->
            <a class="nav-cart" href="/cart">
                <Icon Name="cart" />
                <span>Carrello</span>
                <span class="nav-cart-count @(cartCount > 0 ? "animate-bounce" : "")">@cartCount</span>
            </a>

            <!-- User Section -->
            <div class="nav-user">
                <AuthorizeView>
                    <Authorized>
                        <a href="/profile" class="btn btn-ghost btn-sm" title="Il tuo profilo">
                            <Icon Name="user" />
                        </a>
                        <button class="nav-logout-btn" @onclick="LogoutAsync">
                            <Icon Name="logout" />
                            <span>Esci</span>
                        </button>
                    </Authorized>
                    <NotAuthorized>
                        <button class="nav-login-btn" @onclick="ShowLoginModal">
                            <Icon Name="login" />
                            <span>Accedi</span>
                        </button>
                    </NotAuthorized>
                </AuthorizeView>
            </div>

            <!-- Mobile Menu Toggle -->
            <button class="nav-mobile-toggle" @onclick="ToggleMobileMenu">
                <Icon Name="menu" />
            </button>
        </div>
    </div>
</nav>

<!-- Mobile Navigation -->
<div class="nav-mobile @(showMobileMenu ? "active" : "")" @onclick="CloseMobileMenu">
    <div class="nav-mobile-content" @onclick:stopPropagation="true">
        <div class="nav-mobile-header">
            <a class="nav-brand" href="/" aria-label="Galleria Agostini" @onclick="CloseMobileMenu">
                <img src="/assets/logo.png" alt="Logo Galleria Agostini" class="nav-brand-logo" />
            </a>
            <button class="nav-mobile-close" @onclick="CloseMobileMenu">
                <Icon Name="close" />
            </button>
        </div>

        <div class="nav-mobile-links">
            <a class="nav-mobile-link" href="/" @onclick="CloseMobileMenu">
                <Icon Name="home" />
                <span>Home</span>
            </a>
            <a class="nav-mobile-link" href="/chi-sono" @onclick="CloseMobileMenu">
                <Icon Name="user" />
                <span>Chi Sono</span>
            </a>
            <a class="nav-mobile-link" href="/richiedi-quadro" @onclick="CloseMobileMenu">
                <Icon Name="custom" />
                <span>Quadro Personalizzato</span>
            </a>
            <AuthorizeView Roles="@RoleNames.Admin">
                <Authorized>
                    <a class="nav-mobile-link" href="/admin/paintings" @onclick="CloseMobileMenu">
                        <Icon Name="gallery" />
                        <span>Gestisci Quadri</span>
                    </a>
                    <a class="nav-mobile-link" href="/admin/orders" @onclick="CloseMobileMenu">
                        <Icon Name="orders" />
                        <span>Ordini</span>
                    </a>
                    <a class="nav-mobile-link" href="/admin/shipping" @onclick="CloseMobileMenu">
                        <Icon Name="shipping" />
                        <span>Spedizioni</span>
                    </a>
                    <a class="nav-mobile-link" href="/admin/custom-orders" @onclick="CloseMobileMenu">
                        <Icon Name="requests" />
                        <span>Richieste Personalizzate</span>
                    </a>
                    <a class="nav-mobile-link" href="/admin/users" @onclick="CloseMobileMenu">
                        <Icon Name="user" />
                        <span>Utenti</span>
                    </a>
                </Authorized>
            </AuthorizeView>
        </div>

        <div class="nav-mobile-actions">
            <a class="btn btn-outline btn-full" href="/cart" @onclick="CloseMobileMenu">
                <Icon Name="cart" />
                <span>Carrello (@cartCount)</span>
            </a>
            <AuthorizeView>
                <Authorized>
                    <div class="nav-user-info" style="text-align: center; margin-bottom: 1rem;">
                        <div class="nav-welcome">Benvenuto</div>
                        <div class="nav-username">@context.User.Identity?.Name</div>
                    </div>
                    <button class="btn btn-secondary btn-full" @onclick="LogoutAsync">
                        <Icon Name="logout" />
                        <span>Esci</span>
                    </button>
                </Authorized>
                <NotAuthorized>
                    <button class="btn btn-primary btn-full" @onclick="ShowLoginModal">
                        <Icon Name="login" />
                        <span>Accedi</span>
                    </button>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="main-container">
    <div class="main-content">
        @Body
    </div>
</div>

<!-- Toast Container (per notifiche future) -->
<div class="toast-container" id="toast-container"></div>